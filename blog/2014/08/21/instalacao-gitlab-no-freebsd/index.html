<!DOCTYPE html>
<html lang="br"
>
<head>
    <title>Instalação Gitlab no FreeBSD - Blog GugaBSD</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="/blog/2014/08/21/instalacao-gitlab-no-freebsd/">

        <meta name="author" content="Luiz Gustavo Costa" />
        <meta name="keywords" content="Gitlab,Freebsd" />
        <meta name="description" content="O que é Gitlab ? Gitlab é um gerenciador de repositorio GIT para o ambiente WEB com a maioria das opções oferecidas pelo o Github. Com o Gitlab você terá a oportunidade de ter seu próprio gerenciador de repositorio, no seu ambiente de trabalho. O projeto é desenvolvido em Ruby com ..." />

        <meta property="og:site_name" content="Blog GugaBSD" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Instalação Gitlab no FreeBSD"/>
        <meta property="og:url" content="/blog/2014/08/21/instalacao-gitlab-no-freebsd/"/>
        <meta property="og:description" content="O que é Gitlab ? Gitlab é um gerenciador de repositorio GIT para o ambiente WEB com a maioria das opções oferecidas pelo o Github. Com o Gitlab você terá a oportunidade de ter seu próprio gerenciador de repositorio, no seu ambiente de trabalho. O projeto é desenvolvido em Ruby com ..."/>
        <meta property="article:published_time" content="2014-08-21" />
            <meta property="article:section" content="Gerenciamento" />
            <meta property="article:tag" content="Gitlab" />
            <meta property="article:tag" content="Freebsd" />
            <meta property="article:author" content="Luiz Gustavo Costa" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.sandstone.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/monokai.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>


</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
Blog GugaBSD            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="/pages/contato.html">
                             Contato
                          </a></li>
                         <li><a href="/pages/curriculum.html">
                             Curriculum
                          </a></li>
                        <li class="active">
                            <a href="/category/gerenciamento.html">Gerenciamento</a>
                        </li>
                        <li >
                            <a href="/category/hangout.html">Hangout</a>
                        </li>
                        <li >
                            <a href="/category/lancamento.html">Lançamento</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/blog/2014/08/21/instalacao-gitlab-no-freebsd/"
                       rel="bookmark"
                       title="Permalink to Instalação Gitlab no FreeBSD">
                        Instalação Gitlab no FreeBSD
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-08-21T08:03:00-03:00"> Qui 21 agosto 2014</time>
    </span>



<span class="label label-default">Tags</span>
	<a href="/tag/gitlab.html">Gitlab</a>
        /
	<a href="/tag/freebsd.html">Freebsd</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><img alt="Gitlab Logo" src="/images/gitlab_logo.png" title="Gitlab Logo" /></p>
<h2>O que é Gitlab ?</h2>
<p>Gitlab é um gerenciador de repositorio GIT para o ambiente WEB com a maioria das opções oferecidas pelo o Github. Com o Gitlab você terá a oportunidade de ter seu próprio gerenciador de repositorio, no seu ambiente de trabalho. O projeto é desenvolvido em Ruby com o framework Ruby on Rails.</p>
<p>Veja mais detalhes no site do projeto: https://about.gitlab.org</p>
<h4>O que vamos usar ?</h4>
<p>Instalação pura do:</p>
<p><em>FreeBSD 10 amd64 - GENERIC</em></p>
<div class="codehilite"><pre><span class="cp"># uname -a</span>
<span class="n">FreeBSD</span> <span class="n">gitlab</span><span class="p">.</span><span class="n">gugabsd</span> <span class="mf">10.0</span><span class="o">-</span><span class="n">RELEASE</span> <span class="n">FreeBSD</span> <span class="mf">10.0</span><span class="o">-</span><span class="n">RELEASE</span> <span class="err">#</span><span class="mi">0</span> <span class="n">r260789</span><span class="o">:</span> <span class="n">Thu</span> <span class="n">Jan</span> <span class="mi">16</span> <span class="mi">22</span><span class="o">:</span><span class="mi">34</span><span class="o">:</span><span class="mi">59</span> <span class="n">UTC</span> <span class="mi">2014</span>     <span class="n">root</span><span class="err">@</span><span class="n">snap</span><span class="p">.</span><span class="n">freebsd</span><span class="p">.</span><span class="n">org</span><span class="o">:/</span><span class="n">usr</span><span class="o">/</span><span class="n">obj</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">GENERIC</span>  <span class="n">amd64</span>
</pre></div>


<p><em>Gitlab 7.1 Stable</em></p>
<h4>O que vamos precisar ?</h4>
<p>Vamos usar o gerenciador de pacotes binarios PKG para suprir nossa demanda de pacotes dependentes do Gitlab, para isso, execute o comando abaixo para atualizar o pkg:</p>
<div class="codehilite"><pre>root@gitlab:~ # pkg update

The package management tool is not yet installed on your system.
Do you want to fetch and install it now? [y/N]: y
Bootstrapping pkg from pkg+http://pkg.FreeBSD.org/freebsd:10:x86:64/latest, please wait...
Verifying signature with trusted certificate pkg.freebsd.org.2013102301... done
Installing pkg-1.3.6: 100%
Message for pkg-1.3.6:
 If you are upgrading from the old package format, first run:

  # pkg2ng
Updating repository catalogue
Fetching meta.txz: 100% of 944 B                                                                   
Fetching digests.txz: 100% of 2 MB                                                                  
Fetching packagesite.txz: 100% of 5 MB

Adding new entries: 100%
Incremental update completed, 23436 packages processed:
0 packages updated, 0 removed and 23436 added.
</pre></div>


<p>Feito isto, estamos preparado para instalar os pacotes necessários:</p>
<div class="codehilite"><pre><span class="n">pkg</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">git</span> <span class="n">redis</span> <span class="n">icu</span> <span class="n">libxml2</span> <span class="n">libxslt</span> <span class="n">python2</span> <span class="n">bash</span> <span class="n">sudo</span> <span class="n">gcc</span> <span class="n">gmake</span>
</pre></div>


<p>Para o RVM (veremos abaixo):</p>
<div class="codehilite"><pre><span class="n">pkg</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">autoconf</span> <span class="n">automake</span> <span class="n">libtool</span> <span class="n">bison</span> <span class="n">readline</span> <span class="n">libyaml</span> <span class="n">sqlite3</span> <span class="n">gdbm</span> <span class="n">cmake</span> <span class="n">pkgconf</span>
</pre></div>


<p>Vamos ligar nosso servidor Redis:</p>
<div class="codehilite"><pre><span class="n">echo</span> <span class="err">&#39;</span><span class="n">redis_enable</span><span class="o">=</span><span class="s">&quot;YES&quot;</span><span class="err">&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="p">.</span><span class="n">conf</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">redis</span> <span class="n">start</span>
<span class="n">Starting</span> <span class="n">redis</span><span class="p">.</span>
</pre></div>


<p>Nesse tutorial, vou fazer uso do Postgresql como base de dados do Gitlab, porém, o Gitlab também é compativel com Mysql, fica a seu criterio:</p>
<div class="codehilite"><pre><span class="n">pkg</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">postgresql92</span><span class="o">-</span><span class="n">server</span>
<span class="n">echo</span> <span class="err">&#39;</span><span class="n">postgresql_enable</span><span class="o">=</span><span class="s">&quot;YES&quot;</span><span class="err">&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="p">.</span><span class="n">conf</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">postgresql</span> <span class="n">initdb</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">postgresql</span> <span class="n">start</span>
</pre></div>


<p>Crie a base que iremos usar com o Gitlab:</p>
<div class="codehilite"><pre><span class="n">root</span><span class="err">@</span><span class="n">gitlab</span><span class="o">:~</span> <span class="err">#</span> <span class="n">su</span> <span class="o">-</span> <span class="n">pgsql</span>
<span class="err">$</span> <span class="n">psql</span> <span class="o">-</span><span class="n">d</span> <span class="n">template1</span>
<span class="n">psql</span> <span class="p">(</span><span class="mf">9.2.9</span><span class="p">)</span>
<span class="n">Type</span> <span class="s">&quot;help&quot;</span> <span class="k">for</span> <span class="n">help</span><span class="p">.</span>

<span class="n">template1</span><span class="o">=</span><span class="err">#</span> <span class="n">CREATE</span> <span class="n">USER</span> <span class="n">git</span> <span class="n">CREATEDB</span><span class="p">;</span>
<span class="n">CREATE</span> <span class="n">ROLE</span>
<span class="n">template1</span><span class="o">=</span><span class="err">#</span> <span class="n">CREATE</span> <span class="n">DATABASE</span> <span class="n">gitlabhq_production</span> <span class="n">OWNER</span> <span class="n">git</span><span class="p">;</span>
<span class="n">CREATE</span> <span class="n">DATABASE</span>
<span class="n">template1</span><span class="o">=</span><span class="err">#</span> <span class="err">\</span><span class="n">q</span>
</pre></div>


<p>Como vamos "enjaular" tudo em um usuário do sistema, vamos cria-lo no FreeBSD com o comando abaixo:</p>
<div class="codehilite"><pre><span class="n">pw</span> <span class="n">add</span> <span class="n">user</span> <span class="o">-</span><span class="n">n</span> <span class="n">git</span> <span class="o">-</span><span class="n">m</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s">&quot;GitLab&quot;</span>
</pre></div>


<p>E com o usuário criado, vamos fazer o uso do Ruby, que é a linguagem de construção do Gitlab através do RVM. Para isto, vamos virar usuário <code>git</code> e instalar o ambiente do RVM com uma versão do ruby:</p>
<div class="codehilite"><pre><span class="n">root</span><span class="err">@</span><span class="n">gitlab</span><span class="o">:~</span> <span class="err">#</span> <span class="n">su</span> <span class="o">-</span> <span class="n">git</span>
<span class="p">[</span><span class="n">git</span><span class="err">@</span><span class="n">gitlab</span> <span class="o">~</span><span class="p">]</span><span class="err">$</span> 
<span class="p">[</span><span class="n">git</span><span class="err">@</span><span class="n">gitlab</span> <span class="o">~</span><span class="p">]</span><span class="err">$</span> <span class="err">\</span><span class="n">curl</span> <span class="o">-</span><span class="n">sSL</span> <span class="n">https</span><span class="o">:</span><span class="c1">//get.rvm.io | bash -s stable</span>

<span class="n">source</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="p">.</span><span class="n">rvm</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">rvm</span>
</pre></div>


<p>Agora, instalar o Ruby 2.1.2 necessário para o Gitlab 7.1:</p>
<div class="codehilite"><pre>rvm install 2.1.2

...

Install of ruby-2.1.2 - <span class="c">#complete</span>
</pre></div>


<p>Pronto, já estamos com o ambiente com Ruby instalado e preparado para implementar o Gitlab.</p>
<div class="codehilite"><pre><span class="p">[</span><span class="n">git</span><span class="err">@</span><span class="n">gitlab</span> <span class="o">~</span><span class="p">]</span><span class="err">$</span> <span class="n">which</span> <span class="n">ruby</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="p">.</span><span class="n">rvm</span><span class="o">/</span><span class="n">rubies</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mf">2.1.2</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ruby</span>
<span class="p">[</span><span class="n">git</span><span class="err">@</span><span class="n">gitlab</span> <span class="o">~</span><span class="p">]</span><span class="err">$</span> <span class="n">ruby</span> <span class="o">-</span><span class="n">v</span>
<span class="n">ruby</span> <span class="mf">2.1.2</span><span class="n">p95</span> <span class="p">(</span><span class="mi">2014</span><span class="o">-</span><span class="mo">05</span><span class="o">-</span><span class="mi">08</span> <span class="n">revision</span> <span class="mi">45877</span><span class="p">)</span> <span class="p">[</span><span class="n">x86_64</span><span class="o">-</span><span class="n">freebsd10</span><span class="mf">.0</span><span class="p">]</span>
</pre></div>


<p>Veja mais informações sobre o projeto RVM em: http://rvm.io/</p>
<h4>Começamos então a clonar o repositorio do Gitlab:</h4>
<div class="codehilite"><pre><span class="n">cd</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="o">:</span><span class="c1">//gitlab.com/gitlab-org/gitlab-ce.git -b 7-1-stable gitlab</span>
</pre></div>


<p>E então, começar a configurar o Gitlab:</p>
<p>Copie o arquivo de exemplo do Gitlab:</p>
<div class="codehilite"><pre><span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">gitlab</span>
<span class="n">cp</span> <span class="n">config</span><span class="o">/</span><span class="n">gitlab</span><span class="p">.</span><span class="n">yml</span><span class="p">.</span><span class="n">example</span> <span class="n">config</span><span class="o">/</span><span class="n">gitlab</span><span class="p">.</span><span class="n">yml</span>
</pre></div>


<p><code>ee config/gitlab.yml</code></p>
<ul>
<li>
<p>Altere a entrada <code>localhost</code> para o hostname/dominio completo do seu servidor, por exemplo: <code>gitlab.mundounix.com.br</code></p>
</li>
<li>
<p>Se for usar https, altere a porta de escuta de 80 para 443</p>
</li>
<li>
<p>Corriga o path do usuário git no arquivo de configuração para o formato <code>/usr/home/git</code>, já que o Gitlab não se da bem com links simbolicos. Faça isso nas linhas: 199, 208, 211, 212 do arquivo.</p>
</li>
<li>
<p>Atualize o cominho do binario do git para o padrão do FreeBSD: <code>/usr/local/bin/git</code> na linha 225</p>
<p>cp config/unicorn.rb.example config/unicorn.rb</p>
</li>
</ul>
<p><code>ee config/unicorn.rb</code></p>
<ul>
<li>
<p>Habilite o modo "cluster" se você tiver muito acesso, aumentando o número de "workes" de acordo com a carga do seu servidor (CPU, Memória, etc)</p>
<p>cp config/initializers/rack_attack.rb.example config/initializers/rack_attack.rb</p>
</li>
</ul>
<p>Habilite a configuração da base de dados do Postgresql:</p>
<div class="codehilite"><pre><span class="n">cp</span> <span class="n">config</span><span class="o">/</span><span class="n">database</span><span class="p">.</span><span class="n">yml</span><span class="p">.</span><span class="n">postgresql</span> <span class="n">config</span><span class="o">/</span><span class="n">database</span><span class="p">.</span><span class="n">yml</span>
</pre></div>


<p>Configure uma conta global do GIT para o usuario git do sistema:</p>
<div class="codehilite"><pre><span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">global</span> <span class="n">user</span><span class="p">.</span><span class="n">name</span> <span class="s">&quot;GitLab&quot;</span>
<span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">global</span> <span class="n">user</span><span class="p">.</span><span class="n">email</span> <span class="s">&quot;exemplo@exemplo.com&quot;</span>
<span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">global</span> <span class="n">core</span><span class="p">.</span><span class="n">autocrlf</span> <span class="n">input</span>
</pre></div>


<p>Acertando algumas permissões:</p>
<div class="codehilite"><pre>chown -R git log/
chown -R git tmp/
chmod -R u+rwX log/
chmod -R u+rwX tmp/
chmod -R u+rwX tmp/pids/
chmod -R u+rwX tmp/sockets/
chmod -R u+rwX  public/uploads
</pre></div>


<p>Criando diretorios para "satellites":</p>
<div class="codehilite"><pre><span class="n">mkdir</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">gitlab</span><span class="o">-</span><span class="n">satellites</span>
<span class="n">chmod</span> <span class="n">u</span><span class="o">+</span><span class="n">rwx</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="n">rx</span><span class="p">,</span><span class="n">o</span><span class="o">-</span><span class="n">rwx</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">gitlab</span><span class="o">-</span><span class="n">satellites</span>
</pre></div>


<p>Vamos agora instalar os pacotes <code>Gems</code>, que são uma série de libs do Ruby necessárias para o Gitlab funcionar, usando a ferramenta bundle:</p>
<div class="codehilite"><pre><span class="n">gem</span> <span class="n">install</span> <span class="n">bundle</span>

<span class="n">export</span> <span class="n">CC</span><span class="o">=</span><span class="n">gcc47</span>
<span class="n">export</span> <span class="n">CXX</span><span class="o">=</span><span class="n">c</span><span class="o">++</span><span class="mi">47</span>
<span class="n">export</span> <span class="n">CPP</span><span class="o">=</span><span class="n">cpp47</span>

<span class="n">bundle</span> <span class="n">install</span> <span class="o">--</span><span class="n">deployment</span> <span class="o">--</span><span class="n">without</span> <span class="n">development</span> <span class="n">test</span> <span class="n">mysql</span> <span class="n">aws</span>
</pre></div>


<h2>Instalação do Gitlab Shell</h2>
<p>GitLab Shell é um software de acesso ssh e gerenciamento de repositório desenvolvido especialmente para GitLab.</p>
<p>Vá para o diretorio de instalação do Gitlab:
<code>cd /home/git/gitlab</code></p>
<p>Rode uma tarefa de instalação do gitlab-shell:</p>
<div class="codehilite"><pre><span class="n">bundle</span> <span class="n">exec</span> <span class="n">rake</span> <span class="n">gitlab</span><span class="o">:</span><span class="n">shell</span><span class="o">:</span><span class="n">install</span><span class="p">[</span><span class="n">v1</span><span class="mf">.9.6</span><span class="p">]</span> <span class="n">REDIS_URL</span><span class="o">=</span><span class="n">redis</span><span class="o">:</span><span class="c1">//localhost:6379 RAILS_ENV=production</span>

<span class="cp"># Por padrão, a configuração gitlab-shell é gerado a partir de sua configuração do gitlab principal. </span>
<span class="cp"># </span>
<span class="cp"># Nota: Ao usar GitLab com HTTPS por favor alterar o seguinte: </span>
<span class="cp"># - Fornecer caminhos para os certificados ca_file e ca_path. </span>
<span class="cp"># - A opção &quot;gitlab_url&quot; deve apontar para o https do GitLab. </span>
<span class="cp"># - No caso de você estiver usando o certificado auto-assinado, altere a opção &quot;self_signed_cert&quot; para &quot;true&quot;. </span>
<span class="cp"># Você pode rever (e modificar) a configuração gitlab-shell da seguinte forma: </span>
<span class="n">ee</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">gitlab</span><span class="o">-</span><span class="n">shell</span><span class="o">/</span><span class="n">config</span><span class="p">.</span><span class="n">yml</span>
</pre></div>


<p>Não esqueça ainda de alterar nesse arquivo de configuração o path (caminho) do usuário <em>git</em>, de <code>/home/git</code> para <code>/usr/home/git</code> na linha 7 do arquivo.</p>
<p>Vamos agora inicializar a base de dados:</p>
<div class="codehilite"><pre><span class="n">bundle</span> <span class="n">exec</span> <span class="n">rake</span> <span class="n">gitlab</span><span class="o">:</span><span class="n">setup</span> <span class="n">RAILS_ENV</span><span class="o">=</span><span class="n">production</span>
</pre></div>


<p>Verifique se esta tudo ok:</p>
<div class="codehilite"><pre><span class="n">bundle</span> <span class="n">exec</span> <span class="n">rake</span> <span class="n">gitlab</span><span class="o">:</span><span class="n">env</span><span class="o">:</span><span class="n">info</span> <span class="n">RAILS_ENV</span><span class="o">=</span><span class="n">production</span>
</pre></div>


<p>Configure o cache de componentes web da interface (assets):</p>
<div class="codehilite"><pre><span class="n">bundle</span> <span class="n">exec</span> <span class="n">rake</span> <span class="n">assets</span><span class="o">:</span><span class="n">precompile</span> <span class="n">RAILS_ENV</span><span class="o">=</span><span class="n">production</span>
</pre></div>


<p>Pronto ! Gitlab configurado, precisamos agora configurar a inicilização do mesmo:</p>
<p>Como root (saia do /home do git -&gt; <code>exit</code>):</p>
<div class="codehilite"><pre><span class="n">cp</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">gitlab</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">support</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">gitlab</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">gitlab</span><span class="p">.</span><span class="n">sh</span>
</pre></div>


<p>Feito isso, vamos inicializar o Gitlab:</p>
<div class="codehilite"><pre><span class="n">root</span><span class="err">@</span><span class="n">gitlab</span><span class="o">:~</span> <span class="err">#</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">gitlab</span><span class="p">.</span><span class="n">sh</span> <span class="n">start</span>
<span class="n">Starting</span> <span class="n">both</span> <span class="n">the</span> <span class="n">GitLab</span> <span class="n">Unicorn</span> <span class="n">and</span> <span class="n">Sidekiq</span><span class="p">.</span>
<span class="n">The</span> <span class="n">GitLab</span> <span class="n">Unicorn</span> <span class="n">web</span> <span class="n">server</span> <span class="n">with</span> <span class="n">pid</span> <span class="mi">36244</span> <span class="n">is</span> <span class="n">running</span><span class="p">.</span>
<span class="n">The</span> <span class="n">GitLab</span> <span class="n">Sidekiq</span> <span class="n">job</span> <span class="n">dispatcher</span> <span class="n">with</span> <span class="n">pid</span> <span class="mi">36271</span> <span class="n">is</span> <span class="n">running</span><span class="p">.</span>
<span class="n">GitLab</span> <span class="n">and</span> <span class="n">all</span> <span class="n">its</span> <span class="n">components</span> <span class="n">are</span> <span class="n">up</span> <span class="n">and</span> <span class="n">running</span><span class="p">.</span>

<span class="n">root</span><span class="err">@</span><span class="n">gitlab</span><span class="o">:~</span> <span class="err">#</span> <span class="n">ps</span> <span class="n">ax</span> <span class="o">|</span><span class="n">grep</span> <span class="n">ruby</span>
<span class="mi">36244</span>  <span class="o">-</span>  <span class="n">S</span>      <span class="mi">0</span><span class="o">:</span><span class="mf">10.35</span> <span class="n">ruby</span><span class="o">:</span> <span class="n">unicorn_rails</span> <span class="n">master</span> <span class="o">-</span><span class="n">D</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">gitlab</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">unicorn</span><span class="p">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">E</span> <span class="n">prod</span>
<span class="mi">36248</span>  <span class="o">-</span>  <span class="n">S</span>      <span class="mi">0</span><span class="o">:</span><span class="mf">00.00</span> <span class="n">ruby</span><span class="o">:</span> <span class="n">unicorn_rails</span> <span class="n">worker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span><span class="n">D</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">gitlab</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">unicorn</span><span class="p">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">E</span> <span class="n">p</span>
<span class="mi">36249</span>  <span class="o">-</span>  <span class="n">S</span>      <span class="mi">0</span><span class="o">:</span><span class="mf">00.00</span> <span class="n">ruby</span><span class="o">:</span> <span class="n">unicorn_rails</span> <span class="n">worker</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span><span class="n">D</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">gitlab</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">unicorn</span><span class="p">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">E</span> <span class="n">p</span>
<span class="mi">36271</span>  <span class="o">-</span>  <span class="n">Ss</span>     <span class="mi">0</span><span class="o">:</span><span class="mf">10.15</span> <span class="n">ruby</span><span class="o">:</span> <span class="n">sidekiq</span> <span class="mf">2.17.0</span> <span class="n">gitlab</span> <span class="p">[</span><span class="mi">0</span> <span class="n">of</span> <span class="mi">25</span> <span class="n">busy</span><span class="p">]</span> <span class="p">(</span><span class="n">ruby</span><span class="p">)</span>

<span class="n">root</span><span class="err">@</span><span class="n">gitlab</span><span class="o">:~</span> <span class="err">#</span> <span class="n">sockstat</span> <span class="o">-</span><span class="mi">4l</span>
<span class="n">USER</span>     <span class="n">COMMAND</span>    <span class="n">PID</span>   <span class="n">FD</span> <span class="n">PROTO</span>  <span class="n">LOCAL</span> <span class="n">ADDRESS</span>         <span class="n">FOREIGN</span> <span class="n">ADDRESS</span>      
<span class="n">git</span>      <span class="n">ruby</span>       <span class="mi">36249</span> <span class="mi">13</span> <span class="n">tcp4</span>   <span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">8080</span>        <span class="o">*:*</span>
<span class="n">git</span>      <span class="n">ruby</span>       <span class="mi">36248</span> <span class="mi">13</span> <span class="n">tcp4</span>   <span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">8080</span>        <span class="o">*:*</span>
<span class="n">git</span>      <span class="n">ruby</span>       <span class="mi">36244</span> <span class="mi">13</span> <span class="n">tcp4</span>   <span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">8080</span>        <span class="o">*:*</span>
<span class="n">pgsql</span>    <span class="n">postgres</span>   <span class="mi">11726</span> <span class="mi">4</span>  <span class="n">tcp4</span>   <span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">5432</span>        <span class="o">*:*</span>
</pre></div>


<p>Vamos agora configurar um front para nosso Gitlab e para essa tarefa, vamos usar o Nginx. Porém, se você estiver familiarizado com outro servidor web, você poderá também configura-lo, basta consultar o endereço abaixo para mais informações:</p>
<p>https://gitlab.com/gitlab-org/gitlab-recipes/</p>
<p>Vamos instalar o NGINX:</p>
<div class="codehilite"><pre><span class="n">pkg</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">nginx</span>
</pre></div>


<p>Copie agora o arquivo de configuração pronto do Gitlab para NGINX:</p>
<div class="codehilite"><pre><span class="n">cp</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">gitlab</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">support</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">gitlab</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">gitlab</span><span class="p">.</span><span class="n">conf</span>
</pre></div>


<ul>
<li>Altere o arquivo de acordo com o seu hostname. <em>Isso é importante !</em></li>
<li>Na linha 59, altere a entrada do proxy_pass para o endereço interno do Gitlab: http://127.0.0.1:8080;</li>
<li>Na linha 68, comente a entrada "gzip_static on;" colocando um "#" na frente. A versão do nginx compilada para o repositorio pkg não vem com suporte a gzip. Opcionalmente você poderá ativar isso compilando a versão do nginx para o ports.</li>
</ul>
<p>Adicione agora no arquivo /usr/local/etc/nginx/nginx.conf, antes do ultimo "}", na linha 117, o include para nosso arquivo de configuração do Gitlab:</p>
<div class="codehilite"><pre><span class="n">include</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">gitlab</span><span class="p">.</span><span class="n">conf</span><span class="p">;</span>
</pre></div>


<p>Alguns diretorios necessários para nosso ambiente:</p>
<div class="codehilite"><pre><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">nginx</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">nginx</span>
<span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">www</span><span class="o">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">nginx</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">nginx</span>
</pre></div>


<p>E podemos agora configurar a inicialização do NGINX:</p>
<div class="codehilite"><pre><span class="cp"># echo &#39;nginx_enable=&quot;YES&quot;&#39; &gt;&gt; /etc/rc.conf</span>
<span class="cp"># service nginx start</span>
<span class="n">Performing</span> <span class="n">sanity</span> <span class="n">check</span> <span class="n">on</span> <span class="n">nginx</span> <span class="n">configuration</span><span class="o">:</span>
<span class="nl">nginx:</span> <span class="n">the</span> <span class="n">configuration</span> <span class="n">file</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nginx</span><span class="p">.</span><span class="n">conf</span> <span class="n">syntax</span> <span class="n">is</span> <span class="n">ok</span>
<span class="nl">nginx:</span> <span class="n">configuration</span> <span class="n">file</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nginx</span><span class="p">.</span><span class="n">conf</span> <span class="n">test</span> <span class="n">is</span> <span class="n">successful</span>
<span class="n">Starting</span> <span class="n">nginx</span><span class="p">.</span>
</pre></div>


<p>Agora estamos com a configuração completa ! basta apontar seu navegador para o endereço do servidor e se logar com as credenciais padrões de inicialização:</p>
<div class="codehilite"><pre><span class="n">root</span>
<span class="mi">5</span><span class="n">iveL</span><span class="o">!</span><span class="n">fe</span>
</pre></div>


<p>É isso, qualquer dúvida, comente abaixo.</p>
<p>Referencias:</p>
<p><a href="https://gitlab.com/gitlab-org/gitlab-ce/blob/7-1-stable/doc/install/installation.md">https://gitlab.com/gitlab-org/gitlab-ce/blob/7-1-stable/doc/install/installation.md</a></p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'gugabsd'; // required: replace example with your forum shortname

                    var disqus_identifier = 'instalacao-gitlab-no-freebsd';
                var disqus_url = '/blog/2014/08/21/instalacao-gitlab-no-freebsd/';

            var disqus_config = function () {
                this.language = "br";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="http://twitter.com/gugabsd"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
                <li class="list-group-item"><a href="http://facebook.com/gugabsd"><i class="fa fa-facebook-square fa-lg"></i> Facebook</a></li>
              </ul>
            </li>



            <li class="list-group-item"><a href="/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group " id="tags">
                    <li class="list-group-item tag-1">
                        <a href="/tag/pfsense.html">
                            pfsense
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="/tag/freebsd.html">
                            Freebsd
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="/tag/hangout.html">
                            hangout
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="/tag/firewall.html">
                            firewall
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="/tag/release.html">
                            release
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="/tag/lancamento.html">
                            lançamento
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="/tag/traffic-shapper.html">
                            traffic shapper
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="/tag/samba4.html">
                            samba4
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="/tag/gitlab.html">
                            Gitlab
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="/tag/zfs.html">
                            zfs
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="/tag/cp.html">
                            cp
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="/tag/screencast.html">
                            screencast
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="/tag/qos.html">
                            qos
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="/tag/gravacao.html">
                            gravação
                        </a>
                    </li>
                </ul>
            </li>
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://getpelican.com/" target="_blank">
                Pelican
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://python.org/" target="_blank">
                Python.org
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://jinja.pocoo.org/" target="_blank">
                Jinja2
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Luiz Gustavo Costa
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'gugabsd'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>